<div class="admin-container">
    <div class="admin-header">
        <h1>Admin Panel</h1>
        <p>Manage users and system settings</p>
        <a href="/dashboard" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i>
            Back to Dashboard
        </a>
    </div>

    <% if (messages.success && messages.success.length > 0) { %>
        <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            <%= messages.success[0] %>
        </div>
    <% } %>

    <% if (messages.error && messages.error.length > 0) { %>
        <div class="alert alert-error">
            <i class="fas fa-exclamation-circle"></i>
            <%= messages.error[0] %>
        </div>
    <% } %>

    <div class="admin-stats">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3><%= users.length %></h3>
                <p>Total Users</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-user-shield"></i>
            </div>
            <div class="stat-content">
                <h3><%= users.filter(u => u.role === 'admin').length %></h3>
                <p>Administrators</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-user"></i>
            </div>
            <div class="stat-content">
                <h3><%= users.filter(u => u.role === 'user').length %></h3>
                <p>Regular Users</p>
            </div>
        </div>
    </div>

    <div class="users-section">
        <h2>User Management</h2>
        <div class="users-table-container">
            <table class="users-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(u => { %>
                    <tr>
                        <td><%= u.id %></td>
                        <td><%= u.username %></td>
                        <td><%= u.email %></td>
                        <td>
                            <span class="role-badge role-<%= u.role %>">
                                <%= u.role %>
                            </span>
                        </td>
                        <td><%= new Date(u.created_at).toLocaleDateString() %></td>
                        <td class="actions">
                            <% if (u.id !== user.id) { %>
                                <form action="/dashboard/admin/update-role/<%= u.id %>" method="POST" style="display: inline;">
                                    <select name="role" onchange="this.form.submit()" class="role-select">
                                        <option value="user" <%= u.role === 'user' ? 'selected' : '' %>>User</option>
                                        <option value="admin" <%= u.role === 'admin' ? 'selected' : '' %>>Admin</option>
                                    </select>
                                </form>
                                <form action="/dashboard/admin/delete-user/<%= u.id %>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this user?')">
                                    <button type="submit" class="btn btn-danger btn-sm">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            <% } else { %>
                                <span class="text-muted">Current User</span>
                            <% } %>
                        </td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</div>